<<<<<<< HEAD:Assets/Scripts/Old/OldDialogueManager

// ===========================================
// ğŸ“Œ [ëŒ€ì‚¬ íŒŒì¼ êµ¬ì¡° ì„¤ëª…]
// ===========================================
// ê° ì¤„ì€ í•˜ë‚˜ì˜ ëŒ€ì‚¬ë¥¼ ì˜ë¯¸í•˜ë©°, "|"ë¡œ êµ¬ë¶„ëœ ì—¬ëŸ¬ ê°œì˜ í•„ë“œë¥¼ í¬í•¨í•¨
=======
ï»¿
// ==========================
// [ìŠ¤í¬ë¦½íŠ¸ ì„¤ëª…]
// ==========================
//
// @Author ì´ì§€í™˜
// 2025-03-02 ë¦¬í™í† ë§
// ì•„ë˜ ìŠ¤í¬ë¦½íŠ¸ëŠ” ëŒ€ì‚¬ íŒŒì¼ì„ ê´€ë¦¬í•˜ëŠ” ë‹¤ì´ì–¼ë¡œê·¸ ë§¤ë‹ˆì €ì…ë‹ˆë‹¤.
// íŒŒì¼ ë§¤ë‹ˆì €, í…ìŠ¤íŠ¸ì• ë‹ˆë©”ì´ì…˜ìŠ¤í¬ë¦½íŠ¸, ì„ íƒì§€ë§¤ë‹ˆì €ì™€ ìƒì†ê´€ê³„
//
//
//
//==========================
// [ëŒ€ì‚¬ íŒŒì¼ êµ¬ì¡°]
//==========================
// ê° ì¤„ì€ í•˜ë‚˜ì˜ ëŒ€ì‚¬(ì¸ë±ìŠ¤)ë¥¼ ì˜ë¯¸í•˜ë©°, "|"ë¡œ êµ¬ë¶„ëœ ì—¬ëŸ¬ ê°œì˜ í•„ë“œë¥¼ í¬í•¨í•¨
>>>>>>> main:Assets/Scripts/LJH/Manager/DialogueManager.cs
// í•„ë“œë³„ ì—­í•  ë° ë°ì´í„° í˜•ì‹ ì„¤ëª…ì€ ì•„ë˜ì™€ ê°™ìŒ
//
//
//ğŸ”¹ ì¸ë±ìŠ¤ ì„¤ëª…
// ------------------------------------------------------------------------------------------------
// í™”ì ì´ë¦„|ëŒ€ì‚¬ ë‚´ìš©|íš¨ê³¼ìŒ|ìºë¦­í„° ì´ë¯¸ì§€|ì„ íƒì§€ID|ìŒì„±(ìºë¦­í„° ëª©ì†Œë¦¬)|ë°°ê²½ìŒì•…|ì• ë‹ˆë©”ì´ì…˜ í‚¤ì›Œë“œ
//
// ------------------------------------------------------------------------------------------------
//
// [í•„ë“œ 1] í™”ì ì´ë¦„
//   - ëŒ€ì‚¬ë¥¼ ë§í•˜ëŠ” ìºë¦­í„°ì˜ ì´ë¦„ì„ ì§€ì •í•©ë‹ˆë‹¤.
//   - ì˜ˆ: "ìœ  ì´ì—°"
//
// [í•„ë“œ 2] ëŒ€ì‚¬ ë‚´ìš©
//   - ìºë¦­í„°ê°€ ì¶œë ¥í•  ëŒ€ì‚¬ ë¬¸ìì—´ì…ë‹ˆë‹¤.
//   - ëŒ€ì‚¬ ë‚´ì—ì„œ íŠ¹ì • íƒœê·¸ë¥¼ ì‚¬ìš©í•˜ì—¬ ë‹¤ì–‘í•œ ì—°ì¶œ íš¨ê³¼ë¥¼ ì ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
//
//  ğŸ”¹ íŠ¹ìˆ˜ íƒœê·¸ ì„¤ëª…
//   ---------------------------------------------------------
//   *N  : ë³¼ë¥¨ ì¡°ì ˆ (0~1 ì‚¬ì´ ê°’, ì˜ˆ: *0.5 ë³¼ë¥¨ ë‚®ì¶¤, *1 ì›ë˜ ë³¼ë¥¨)
//   #N  : í”¼ì¹˜ ì¡°ì ˆ (-3~3 ì‚¬ì´ ê°’, ì˜ˆ: #0.03 í”¼ì¹˜ ì¦ê°€, #-0.03 í”¼ì¹˜ ê°ì†Œ)
//   \N  : ì¶œë ¥ ì†ë„ ë³€ê²½ (ì˜ˆ: \2 -> ì†ë„ 2ë°° ë¹ ë¥´ê²Œ)
//   $N  : ì¶œë ¥ ëŒ€ê¸° ì‹œê°„ (ì˜ˆ: $0.5 -> 0.5ì´ˆ í›„ ë‹¤ìŒ ê¸€ì ì¶œë ¥)
//   ^   : ë„ë• ì• ë‹ˆë©”ì´ì…˜ ì‹¤í–‰
//   %   : ì„ íƒì§€ í‘œì‹œ (í•´ë‹¹ ì¤„ì´ ì„ íƒì§€ íŒ¨ë„ì„ ë„ìš°ë„ë¡ ì²˜ë¦¬)
//   @   : ë§¨ ë§ˆì§€ë§‰ì— ë“±ì¥í•  ê²½ìš° ë°”ë¡œ ë‹¤ìŒ ë¬¸ì¥ì„ ì¶œë ¥
//   ---------------------------------------------------------
//
// [í•„ë“œ 3] íš¨ê³¼ìŒ (SE, Sound Effect)
//   - íŠ¹ì • ëŒ€ì‚¬ì—ì„œ ì¬ìƒí•  íš¨ê³¼ìŒ íŒŒì¼ì˜ ì´ë¦„ì„ ì§€ì •í•©ë‹ˆë‹¤.
//   - ì˜ˆ: "Knock" (Knock.mp3 íŒŒì¼ ì¬ìƒ)
//
// [í•„ë“œ 4] ìºë¦­í„° ì´ë¯¸ì§€
//   - ëŒ€ì‚¬ ì§„í–‰ ì¤‘ ë³€ê²½í•  ìºë¦­í„°ì˜ ì´ë¯¸ì§€ íŒŒì¼ëª…ì„ ì§€ì •í•©ë‹ˆë‹¤.
//   - ì˜ˆ: "image_nurse_concept_1"
//
// [í•„ë“œ 5] ì„ íƒì§€ ID
//   - íŠ¹ì • ëŒ€ì‚¬ì—ì„œ ì„ íƒì§€ê°€ ë‚˜íƒ€ë‚  ê²½ìš° í•´ë‹¹ ì„ íƒì§€ì˜ IDë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
//   - ì—†ì„ ê²½ìš° ë¹ˆ ë¬¸ìì—´("")ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.
//   - ì˜ˆ: "1" (ì„ íƒì§€ê°€ ìˆëŠ” ê²½ìš°), "" (ì„ íƒì§€ê°€ ì—†ëŠ” ê²½ìš°)
//
// [í•„ë“œ 6] ìŒì„± (Voice)
//   - ëŒ€ì‚¬ì— ë§ì¶° ì¬ìƒí•  ìŒì„± íŒŒì¼ëª…ì„ ì§€ì •í•©ë‹ˆë‹¤.
//   - ì˜ˆ: "voice" (voice.mp3 íŒŒì¼ ì¬ìƒ)
//
// [í•„ë“œ 7] ë°°ê²½ ìŒì•… (BGM)
//   - íŠ¹ì • ëŒ€ì‚¬ì—ì„œ ë³€ê²½í•  ë°°ê²½ ìŒì•…ì„ ì§€ì •í•©ë‹ˆë‹¤.
//   - ì˜ˆ: "downvoice"
//
// [í•„ë“œ 8] ì• ë‹ˆë©”ì´ì…˜ í‚¤ì›Œë“œ
//   - íŠ¹ì • ì• ë‹ˆë©”ì´ì…˜ì„ ì‹¤í–‰í•˜ê¸° ìœ„í•œ í‚¤ì›Œë“œë¥¼ ì§€ì •í•©ë‹ˆë‹¤.
//   - ì˜ˆ: "ë„ë•" (ë„ë•ì´ëŠ” ì• ë‹ˆë©”ì´ì…˜ ì‹¤í–‰), "ì–´ë‘ " (í™”ë©´ ì–´ë‘ì›Œì§ ë“±)
//
// ===========================================
// [íŒŒì¼ ì˜ˆì‹œ]
// ===========================================
// ìœ  ì´ì—°|ì§€ê¸ˆ ê¸°ë¶„ì´ ì–´ë– ì„¸ìš”?\1.5$0.5 ì–´ë”” ì•„í”ˆ ê³³ì€\0.5 ì—†ë‚˜ìš”?||image_nurse_concept_1||voice|ê°„í˜¸ì‚¬_ê¸°ë³¸|
// ìœ  ì´ì—°|ê´œì°®ì•„ìš”.$1 ì²œì²œíˆ ìˆ¨ ì‰¬ì„¸ìš”.\2.5$0.5 ê¹Šê²Œ*0 ...$0.5 *1ì²œì²œíˆ*0 ...||image_nurse_concept_1||downvoice||
// ìœ  ì´ì—°|*1ê·¸ëŸ¼,$0.5 ì˜¤ëŠ˜ë„ í‰ë²”í•œ í•˜ë£¨ë¥¼ ë³´ë‚´ë„ë¡ í•´ìš”.|Knock|image_nurse_concept_1||voice||ë„ë•|ì–´ë‘ 
//
// ===========================================
// [ì¶”ê°€ ì‚¬í•­]
// ===========================================
// - ëŒ€ì‚¬ íŒŒì¼ì„ ìˆ˜ì •í•  ë•Œ, íƒœê·¸ ì‚¬ìš© ì‹œ ì£¼ì˜í•´ì•¼ í•©ë‹ˆë‹¤.
// - ê° í•„ë“œëŠ” "|" êµ¬ë¶„ìë¡œ ë‚˜ë‰˜ë©°, ê°œìˆ˜ê°€ ë§ì§€ ì•Šì„ ê²½ìš° ì˜¤ë¥˜ê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
// - íƒœê·¸ë¥¼ ì˜¬ë°”ë¥´ê²Œ ì‚¬ìš©í•˜ì—¬ ì—°ì¶œì„ í’ë¶€í•˜ê²Œ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
//
// ===========================================
using System.Collections;
using UnityEngine;
using TMPro;
using UnityEngine.UI;
using System.IO;

public class DialogueManager : MonoBehaviour
{
    [Header("======= íŒŒì¼ ë§¤ë‹ˆì € =========")]
    public FileManager fileManager;

    [Header("======== ë„ë• ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ ========")]
    public NodEffect nodEffect;

    [Header("====== UI ìš”ì†Œë“¤ =======")]
    public TMP_Text speakerText;
    public TextAnimationScripts textAnimationScript;
    public Image characterImage;

    [Header("===== ì˜¤ë””ì˜¤ ì†ŒìŠ¤ ======")]
    public AudioSource seAudioSource;
    public AudioSource voiceAudioSource;
    public AudioSource bgmAudioSource;

    [Header("===== SE (íš¨ê³¼ìŒ) ê¸°ë³¸ê°’ =====")]
    public AudioClip defaultSE;

    [Header("==== ì„ íƒì§€ íŒ¨ë„ =====")]
    public GameObject choicePanel;
    public Button[] choiceButtons;

    [Header("===== ì„ íƒì§€ ë§¤ë‹ˆì € =======")]
    public ChoiceManager choiceManager; 
    public FileManager filea = new FileManager();

    private int currentIndex = 0;
    private bool isChoicePanelActive = false; // ì„ íƒì§€ íŒ¨ë„ í™œì„±í™” ì—¬ë¶€
    private bool isWaitingForText = false;   // ëŒ€ì‚¬ ì¶œë ¥ì´ ëë‚  ë•Œê¹Œì§€ í‚¤ ì…ë ¥ ë°©ì§€

    void Start()
    {
        if (fileManager == null)
        {
            Debug.LogError("FileManagerê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤!");
            return;
        }

        fileManager.LoadAllTextFiles();
        choicePanel.SetActive(false);
        isChoicePanelActive = false;

        foreach (var button in choiceButtons)
        {
            int index = System.Array.IndexOf(choiceButtons, button);
            button.onClick.AddListener(() => SelectChoice(index));
        }

        if (!string.IsNullOrEmpty(fileManager.currentFile))
            LoadDialogue(fileManager.currentFile);
    }

    void Update()
    {
        if (isChoicePanelActive) return; // ì„ íƒì§€ íŒ¨ë„ì´ í™œì„±í™”ëœ ê²½ìš° í‚¤ ì…ë ¥ ì°¨ë‹¨

        if (Input.GetKeyDown(KeyCode.Space) || Input.GetMouseButtonDown(0))
        {
            if (textAnimationScript.IsTyping) // í…ìŠ¤íŠ¸ ì• ë‹ˆë©”ì´ì…˜ ì¤‘ì´ë©´ ìŠ¤í‚µ
            {
                textAnimationScript.SkipTyping();
            }
            else if (!isWaitingForText) // ëŒ€ì‚¬ ì¶œë ¥ì´ ëë‚¬ë‹¤ë©´ ë‹¤ìŒ ëŒ€ì‚¬ë¡œ ì´ë™
            {
                currentIndex++;
                ShowNextLine();
            }
        }
    }

    public void LoadDialogue(string fileName)
    {
        fileManager.SetCurrentFile(fileName);
        currentIndex = 0;
        ShowNextLine();
    }

    public void ShowNextLineAfterChoice()
    {
        currentIndex++; // ì„ íƒì§€ ì´í›„ ë‹¤ìŒ ì¸ë±ìŠ¤ë¡œ ì´ë™, ì¦‰ ë‹¤ìŒ ë¬¸ì¥ì„ ë¶ˆëŸ¬ì˜´
        ShowNextLine();
    }

    public void ShowNextLine()
    {
        if (isChoicePanelActive) return; // ì„ íƒì§€ íŒ¨ë„ì´ í™œì„±í™”ë˜ì—ˆì„ ë•Œ í‚¤ ì…ë ¥ ì°¨ë‹¨í•˜ëŠ” ì—­í• 

<<<<<<< HEAD:Assets/Scripts/Old/OldDialogueManager
        // ğŸ”¹ í˜„ì¬ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        var data = fileManager.GetRowByIndex(currentIndex);
=======
        //  í˜„ì¬ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        var data = fileManager.GetRowByIndex(fileManager.currentFile, currentIndex);
>>>>>>> main:Assets/Scripts/LJH/Manager/DialogueManager.cs

        if (data == null || data.Length == 0)
        {
            Debug.Log($" ëŒ€ì‚¬ íŒŒì¼ì˜ ë§ˆì§€ë§‰ ì¤„ì— ë„ë‹¬í–ˆìŠµë‹ˆë‹¤. (currentIndex: {currentIndex})");
            return;
        }

        Debug.Log($" ShowNextLine í˜¸ì¶œ (currentIndex: {currentIndex})");

        // ë°ì´í„° í•„ë“œ ë¶„ë¦¬ êµ¬ë¶„ì ì‚¬ìš©
        string speaker = data[0]?.Trim();
        string dialogue = data[1]?.Trim();
        string se = data[2]?.Trim();
        string image = data[3]?.Trim();
        string choiceField = data[4]?.Trim();  // ì„ íƒì§€ íŒŒì¼ëª…:ID (ê³µë°±ì´ë©´ ì„ íƒì§€ ì—†ìŒ)
        string voice = data[5]?.Trim();
        string bgm = data[6]?.Trim();
        string animationKeyword = data.Length > 7 ? data[7]?.Trim() : "";

        Debug.Log($" ëŒ€ì‚¬ ì •ë³´ - í™”ì: {speaker}, ëŒ€ì‚¬: {dialogue}, ì„ íƒì§€ ë°ì´í„°: {choiceField}");

        //  `@` íƒœê·¸ í™•ì¸ â†’ ì¦‰ì‹œ ë‹¤ìŒ ëŒ€ì‚¬ ì¶œë ¥
        if (dialogue.Contains("@"))
        {
            dialogue = dialogue.Replace("@", ""); // `@` íƒœê·¸ ì œê±°
            speakerText.text = speaker;
            textAnimationScript.SetText(dialogue, null, () =>
            {
                Debug.Log(" `@` íƒœê·¸ ê°ì§€ â†’ ìë™ìœ¼ë¡œ ë‹¤ìŒ ëŒ€ì‚¬ ì¶œë ¥");
                currentIndex++;
                ShowNextLine(); // ë‹¤ìŒ ëŒ€ì‚¬ë¥¼ ìë™ ì‹¤í–‰
            }, null); //  `onTrigger` ë§¤ê°œë³€ìˆ˜ì— `null` ì¶”ê°€

            return;
        }

        //  UI í…ìŠ¤íŠ¸ ì„¤ì •
        speakerText.text = string.IsNullOrEmpty(speaker) ? " " : speaker;
        //  ^ ê¸°í˜¸ ì œê±°
        if (dialogue.Contains("^"))
        {
            dialogue = dialogue.Replace("^", ""); // ^ íƒœê·¸ ì œê±°
            Debug.Log(" ë„ë• íƒœê·¸(^): ì œê±°ë¨");
        }
        //  % íƒœê·¸ ì œê±° ë° ì„ íƒì§€ ì—¬ë¶€ í™•ì¸
        bool hasChoice = dialogue.Contains("%");
        if (hasChoice)
        {
            dialogue = dialogue.Replace("%", ""); // % íƒœê·¸ ì œê±°
            Debug.Log(" ì„ íƒì§€ íƒœê·¸(%): ì„ íƒì§€ ìˆìŒ");
        }

        //  ìŒì„± í´ë¦½ ë¡œë“œ
        var voiceClip = !string.IsNullOrEmpty(voice)
            ? Resources.Load<AudioClip>($"Audio/Voice/{voice}")
            : null;

        //  ì„ íƒì§€ ê´€ë ¨ ë³€ìˆ˜ ì´ˆê¸°í™”
        string choiceFile = null;
        int choiceID = -1;

        if (!string.IsNullOrEmpty(choiceField))
        {
            if (choiceField.Contains(":"))
            {
                string[] choiceParts = choiceField.Split(':'); // "íŒŒì¼ëª…:ID" í˜•ì‹
                if (choiceParts.Length == 2)
                {
                    choiceFile = choiceParts[0].Trim();
                    if (int.TryParse(choiceParts[1].Trim(), out choiceID))
                    {
                        hasChoice = true; // ì„ íƒì§€ê°€ ìˆìŒ
                        Debug.Log($" ì„ íƒì§€ íŒŒì‹± ì„±ê³µ: choiceFile = {choiceFile}, choiceID = {choiceID}");
                    }
                    else
                    {
                        Debug.LogError($" ì„ íƒì§€ ID ë³€í™˜ ì‹¤íŒ¨: {choiceParts[1]}");
                    }
                }
                else
                {
                    Debug.LogError($" ì„ íƒì§€ í•„ë“œ í˜•ì‹ì´ ì˜ëª»ë˜ì—ˆìŠµë‹ˆë‹¤: {choiceField}");
                }
            }
            else
            {
                Debug.LogError($" ì„ íƒì§€ í•„ë“œì— ':'ê°€ ì—†ìŠµë‹ˆë‹¤: {choiceField}");
            }
        }


        //  ì„ íƒì§€ê°€ ì—†ëŠ” ê²½ìš° â†’ ì–¸ì œë“  í‚¤ ì…ë ¥ ê°€ëŠ¥í•˜ë„ë¡ ì„¤ì •
        if (!hasChoice)
        {
            isWaitingForText = false;
            Debug.Log(" ì„ íƒì§€ê°€ ì—†ìŒ. í‚¤ ì…ë ¥ ì‹œ ë‹¤ìŒ ëŒ€ì‚¬ë¡œ ì´ë™ ê°€ëŠ¥.");
        }
        else
        {
            isWaitingForText = true;
            Debug.Log(" ì„ íƒì§€ê°€ ìˆìŒ. ëŒ€ì‚¬ê°€ ì¶œë ¥ë  ë•Œê¹Œì§€ í‚¤ ì…ë ¥ ì°¨ë‹¨.");
            if (hasChoice)
            {
                //  ì„ íƒì§€ê°€ ìˆëŠ” ê²½ìš° ì„ íƒì§€ íŒ¨ë„ í˜¸ì¶œ
                Debug.Log($" ì„ íƒì§€ íŒ¨ë„ í˜¸ì¶œ ì¤€ë¹„: choiceFile = {choiceFile}, choiceID = {choiceID}");
                isChoicePanelActive = true; //  ì„ íƒì§€ í™œì„±í™” ìƒíƒœ ì„¤ì • (ë‹¤ìŒ ëŒ€ì‚¬ë¡œ ë„˜ì–´ê°€ì§€ ì•ŠìŒ)
            }
            else
            {
                //  ì„ íƒì§€ê°€ ì—†ëŠ” ê²½ìš° â†’ í‚¤ ì…ë ¥ ê°€ëŠ¥í•˜ë„ë¡ ì„¤ì •
                isWaitingForText = false;
                Debug.Log(" ì„ íƒì§€ê°€ ì—†ìŒ. í‚¤ ì…ë ¥ ëŒ€ê¸° ì¤‘.");
            }
        }

        //  í…ìŠ¤íŠ¸ ì• ë‹ˆë©”ì´ì…˜ ì‹¤í–‰ (ë„ì¤‘ % íƒœê·¸ë¥¼ ë§Œë‚˜ë©´ ì„ íƒì§€ íŒ¨ë„ í˜¸ì¶œ)
        textAnimationScript.SetText(dialogue, voiceClip,
            () =>
            {
                Debug.Log($" ëŒ€ì‚¬ ì¶œë ¥ ì™„ë£Œ (currentIndex: {currentIndex})");

                if (hasChoice)
                {
                    Debug.Log($" ì„ íƒì§€ íŒ¨ë„ í˜¸ì¶œ ì¤€ë¹„: choiceFile = {choiceFile}, choiceID = {choiceID}");
                    StartCoroutine(ShowChoicePanel(choiceFile, choiceID));
                    isChoicePanelActive = true;
                }
                else
                {
                    isWaitingForText = false;
                    Debug.Log(" ì„ íƒì§€ê°€ ì—†ìŒ. í‚¤ ì…ë ¥ ëŒ€ê¸° ì¤‘.");
                }
            },
            () =>
            {
                // í…ìŠ¤íŠ¸ ì• ë‹ˆë©”ì´ì…˜ ë„ì¤‘ % íƒœê·¸ë¥¼ ë§Œë‚˜ë©´ ì¦‰ì‹œ ì„ íƒì§€ë¥¼ ë„ì›€
                if (hasChoice)
                {
                    Debug.Log(" % íƒœê·¸ ê°ì§€ë¨ â†’ ì„ íƒì§€ íŒ¨ë„ ì¦‰ì‹œ ë„ìš°ê¸°");
                    StartCoroutine(ShowChoicePanel(choiceFile, choiceID));
                    isChoicePanelActive = true;
                }
            });


        //  íš¨ê³¼ìŒ(SE) ì¬ìƒ
        if (!string.IsNullOrEmpty(se))
        {
            var seClip = Resources.Load<AudioClip>($"Audio/SE/{se}");
            if (seClip != null)
            {
                seAudioSource.PlayOneShot(seClip);
            }
            else
            {
                Debug.LogWarning($" SE íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: {se}");
            }
        }

        //  ìºë¦­í„° ì´ë¯¸ì§€ ì„¤ì •
        if (!string.IsNullOrEmpty(image))
        {
            var sprite = Resources.Load<Sprite>($"Graphics/Image/{image}");
            if (sprite != null)
            {
                characterImage.sprite = sprite;
            }
            else
            {
                Debug.LogWarning($" ì´ë¯¸ì§€ íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: {image}");
            }
        }

        //  ë°°ê²½ìŒì•…(BGM) ì¬ìƒ
        if (!string.IsNullOrEmpty(bgm))
        {
            var bgmClip = Resources.Load<AudioClip>($"Audio/BGM/{bgm}");
            if (bgmClip != null && bgmClip != bgmAudioSource.clip)
            {
                bgmAudioSource.clip = bgmClip;
                bgmAudioSource.Play();
            }
        }

        //  ì• ë‹ˆë©”ì´ì…˜ ì²˜ë¦¬
        if (!string.IsNullOrEmpty(animationKeyword) && animationKeyword == "ë„ë•")
        {
            if (nodEffect != null)
            {
                Debug.Log(" ë„ë• ì• ë‹ˆë©”ì´ì…˜ ì‹¤í–‰");
                nodEffect.StartNod();
            }
        }
    }


    IEnumerator ShowChoicePanel(string choiceFile, int choiceID)
    {
        Debug.Log($" ShowChoicePanel í˜¸ì¶œë¨: choiceFile = {choiceFile}, choiceID = {choiceID}");

        if (choiceManager == null)
        {
            Debug.LogError(" choiceManagerê°€ nullì…ë‹ˆë‹¤!");
            yield break;
        }

        yield return new WaitForSeconds(0.5f);

        choicePanel.SetActive(true);
        choiceManager.LoadChoices(choiceFile, choiceID);
        isChoicePanelActive = true;
        Debug.Log(" ì„ íƒì§€ íŒ¨ë„ í™œì„±í™” ì™„ë£Œ");
    }


    public void OnChoiceSelected(string nextFile, int nextIndex)
    {
        Debug.Log($" OnChoiceSelected í˜¸ì¶œë¨: nextFile = {nextFile}, nextIndex = {nextIndex}");

        if (!string.IsNullOrEmpty(nextFile))
        {
            fileManager.SetCurrentFile(nextFile);
            currentIndex = nextIndex-1; // ë‹¤ìŒ ì¸ë±ìŠ¤ë¡œ ì´ë™
       
        }
        else
        {
            Debug.Log(" ë‹¤ìŒ íŒŒì¼ì´ ì—†ìŒ. í˜„ì¬ íŒŒì¼ ìœ ì§€í•˜ê³  ë‹¤ìŒ ëŒ€ì‚¬ ì¶œë ¥.");
            currentIndex = nextIndex-1; // ê¸°ì¡´ íŒŒì¼ì—ì„œ ë‹¤ìŒ ì¸ë±ìŠ¤ë¡œ ì´ë™
       
        }

        isChoicePanelActive = false;
        isWaitingForText = false;

        ShowNextLine();
    }

    public void SelectChoice(int choiceIndex)
    {
        choicePanel.SetActive(false);
        isChoicePanelActive = false;
    }
    public int GetCurrentIndex()
    {
        return currentIndex;
    }

    public void SetCurrentIndex(int newIndex)
    {
        currentIndex = newIndex;
    }

}